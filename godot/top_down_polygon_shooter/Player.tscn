[gd_scene load_steps=3 format=3 uid="uid://cmxbvegddblyc"]

[ext_resource type="Texture2D" uid="uid://my2esya7p48f" path="res://assets/2d_lights_and_shadows_neutral_point_light.webp" id="2_5dfwi"]

[sub_resource type="GDScript" id="GDScript_0r2fa"]
script/source = "extends CharacterBody2D

@export var speed = 1000
@export var acceleration = 0.1
@export var friction = 0.05

var direction = Vector2()

# TODO : Ajouter timer au jeu
var bullet_speed = 1000
var bullet = preload(\"res://Bullet.tscn\")

func _physics_process(delta):
	direction.x = Input.get_action_strength(\"right\") - Input.get_action_strength(\"left\")
	direction.y = Input.get_action_strength(\"down\") - Input.get_action_strength(\"up\")
	
	direction = direction.normalized()
	
	look_at(get_global_mouse_position())
	
	if (Input.is_action_just_pressed(\"fire\")):
		fire()
	
	if (direction.length() > 0):
		velocity = velocity.lerp(direction * speed, acceleration)
	else :
		velocity = velocity.lerp(Vector2.ZERO, friction)
			
	move_and_slide()


func fire():
	var bullet_instance = bullet.instantiate()
	bullet_instance.position = get_global_position() + (Vector2.from_angle(rotation) * 25)
	bullet_instance.rotation_degrees = rotation_degrees
	bullet_instance.apply_impulse(Vector2(bullet_speed, 0).rotated(rotation))
	get_tree().get_root().call_deferred(\"add_child\", bullet_instance)
 
func _on_area_2d_area_entered(area):
	print(area.get_parent().name)
	if \"Enemy\" in area.get_parent().name :
		var _tmp = get_tree().reload_current_scene()
"

[node name="Player" type="CharacterBody2D"]
z_index = 1
motion_mode = 1
script = SubResource("GDScript_0r2fa")
metadata/_edit_group_ = true
metadata/_edit_lock_ = true

[node name="Polygon2D" type="Polygon2D" parent="."]
position = Vector2(-1, -1)
polygon = PackedVector2Array(1, -15, 17, 1, 1, 17, -15, 17, -15, -15)

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="."]
polygon = PackedVector2Array(0, -16, 16, 0, 0, 16, -16, 16, -16, -16)

[node name="Area2D" type="Area2D" parent="."]
visible = false

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="Area2D"]
polygon = PackedVector2Array(-17, -17, 1, -17, 17, 0, 1, 17, -17, 17)

[node name="Camera2D" type="Camera2D" parent="."]
position_smoothing_enabled = true

[node name="PointLight2D" type="PointLight2D" parent="."]
shadow_enabled = true
texture = ExtResource("2_5dfwi")
texture_scale = 3.0

[connection signal="area_entered" from="Area2D" to="." method="_on_area_2d_area_entered"]
